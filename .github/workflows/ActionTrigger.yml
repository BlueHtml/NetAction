name: ActionTrigger

on:
  watch:
    types: [started]
  schedule:
    - cron:  '0 1 * * *'

jobs:
  build:

    if: github.actor == github.repository_owner
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v5

    - name: "Setup environment variables from secrets"
      env:
        SECRETS_CONTEXT: ${{ toJSON(secrets) }}
      run: |
        echo "Setting up environment variables from GitHub secrets..."
        echo "$SECRETS_CONTEXT" | jq -r 'to_entries[] | "\(.key)=\(.value)"' >> $GITHUB_ENV
        echo "Environment variables configured from secrets"

    - name: Wait
      if: github.event_name != 'watch'
      run: |
        random_time=$(($RANDOM % 45))
        echo "等待 ${random_time} 分钟后开始执行"
        for((i=1;i<=${random_time};i++));  
        do
        echo "倒计时:剩余 $[${random_time}-$i] 分钟"
        sleep 1m
        done

    - name: Run
      run: dotnet ActionTrigger.cs
